{% extends "base.html" %}

{% block content %}
<div class="w-full max-w-2xl mx-auto px-4 py-10">
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-md border border-white/20 p-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Edit Profile</h1>

    <form method="post" class="space-y-6" action="{% url 'profile_edit' %}">
            {% csrf_token %}

            <!-- User Form -->
            <div class="space-y-4">
                {% for field in user_form %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            {{ field.label }}
                          {% if field.field.required %}
                          <span class="text-red-500">*</span>
                          {% endif %}
                        </label>
                        {{ field }}
                        {% if field.errors %}
                            <p class="text-sm text-red-600 mt-1">{{ field.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>

            <!-- Profile Form -->
            <div class="space-y-4">
                {% for field in profile_form %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            {{ field.label }}
                          {% if field.field.required %}
                          <span class="text-red-500">*</span>
                          {% endif %}
 
                        </label>
                        {{ field }}
                        {% if field.errors %}
                            <p class="text-sm text-red-600 mt-1">{{ field.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>

            <div class="mt-8">
                <button type="submit"
                    class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const countryElement = document.getElementById("id_country");
    const timezoneElement = document.getElementById("id_timezone");

    if (!countryElement || !timezoneElement) {
        console.warn("Country or timezone field not found");
        return;
    }

    const timezoneUrl = "{% url 'get_timezones' %}";

    function updateTimezoneChoices() {
        const country = countryElement.value;

        if (!country) {
            timezoneElement.disabled = true;
            timezoneElement.innerHTML = '<option value="">Select a country first</option>';
            return;
        }

        timezoneElement.disabled = false;
        timezoneElement.innerHTML = '<option value="">Loading...</option>';

        fetch(`${timezoneUrl}?country=${encodeURIComponent(country)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                timezoneElement.innerHTML = '<option value="">---------</option>';

                if (data.timezones && data.timezones.length > 0) {
                    data.timezones.forEach(tz => {
                        const option = document.createElement("option");
                        option.value = tz.value;
                        option.textContent = tz.label;
                        timezoneElement.appendChild(option);
                    });
                } else {
                    timezoneElement.innerHTML = '<option value="">No timezones available</option>';
                }
            })
            .catch(error => {
                console.error("Error fetching timezones:", error);
                timezoneElement.innerHTML = '<option value="">Error loading timezones</option>';
            });
    }

    // Update when country changes
    countryElement.addEventListener('change', updateTimezoneChoices);
});
</script>
{% endblock %}
